<!DOCTYPE html>
<html>
<style>
.modal {
  display: none;
  z-index: 1;
  position: fixed;
  width: 100%;
  height: 100%;
  background-color: rgb(0, 0, 0);
  background-color: rgba(0, 0, 0, 0.4);
  overflow: inherit;
  overflow-y: inherit;
  text-align: center;
  word-wrap: break-word;
}
.modal-dialog {
  padding: 0;
  display: inline-block;
  text-align: left;
  vertical-align: middle;
  width: 100%;
  height: 100%;
}
/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}
</style>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    $(function(){
      $("#modal-body").load("/static/project_config_submission_form.html");
    });
    </script>
</head>

<body>
    <!-- Modal -->
    <div class="modal fade" id="deviceLogsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <link href="/assets/css/change_config_modal_styles.css" rel="stylesheet">
          <div id="modal-body" class="modal-body" style="margin:auto;"></div>
    </div>
    <div class="topnav">
        <link href="/assets/css/top_navigation_style.css" rel="stylesheet">
        <a href="/">Home</a>
        <a class="active" href="configuration">Project configuration</a>
        <a href="iOSContainers">iOS containers</a>
        <a href="androidContainers">Android containers</a>
    </div>
    <div>
    <table id="configurationInfoTable">
        <link href="/assets/css/config_table.css" rel="stylesheet">
        <tr>
            <th>Devices Host
                <div class="tooltip">?
                    <span class="tooltiptext">The address of the host machine</span>
                </div>
            </th>
            <th>Selenium Hub Host
                <div class="tooltip">?
                    <span class="tooltiptext">The address of the targetted Selenium Hub. Not used if you won't connect
                        to Selenium Hub.</span>
                </div>
            </th>
            <th>Selenium Hub Port
                <div class="tooltip">?
                    <span class="tooltiptext">The port of the targetted Selenium Hub. Not used if you won't connect to
                        Selenium Hub.</span>
                </div>
            </th>
            <th>Selenium Hub Protocol Type
                <div class="tooltip">?
                    <span class="tooltiptext">The protocol type of the targetted Selenium Hub. Not used if you won't
                        connect to Selenium Hub.</span>
                </div>
            </th>
            <th>WDA Bundle ID
                <div class="tooltip">?
                    <span class="tooltiptext">The bundle ID of the targetted WDA application.</span>
                </div>
            </th>
        </tr>
        <tr>
            <td>{{.DevicesHost}}</td>
            <td>{{.SeleniumHubHost}}</td>
            <td>{{.SeleniumHubPort}}</td>
            <td>{{.SeleniumHubProtocolType}}</td>
            <td>{{.WdaBundleID}}</td>
        </tr>
    </table>
    </div>
    <button type="button" onclick="showInfoModal()">Show form</button>
    <script>
        $("#config-form").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var data = $(form).serializeArray();
            $.ajax({
                url: "/updateConfig",
                type: 'post',
                processData: false,
                contentType: 'JSON',
                data: JSON.stringify(getFormData(data)),
                success: function () {
                    alert("Successfully updated project config")
                    /* Reload the page to get the new info */
                    location.reload();
                },
                error: function () {
                    alert("Could not update project config");
                }
            })
        });
        /* Convert the form data array to a proper json */
        function getFormData(data) {
            var unindexed_array = data;
            var indexed_array = {};

            $.map(unindexed_array, function (n, i) {
                indexed_array[n['name']] = n['value'];
            });

            return indexed_array;
        }
        /* Show info modal with provided text */
    		function showInfoModal() {
    			/* Get the modal element */
    			var modal = document.getElementById("deviceLogsModal")

    			/* Get the close button */
    			var span = document.getElementsByClassName("close")[0]

    			/* Display the modal blocking interaction */
    			modal.style.display = "block";

    			/* Close the modal if you click anywhere outside the modal */
    			window.onclick = function (event) {
    				if (event.target == modal) {
    					modal.style.display = "none";
    				}
    			}
    		}
    </script>
</body>

</html>
